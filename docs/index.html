
<!DOCTYPE HTML>
<html>
 <head>
  <meta charset="utf-8"/>
  <title>Cadastre</title>
  <link type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.1/styles/github.min.css" rel="stylesheet"/>
  <link type="text/css" href="https://docs.3liz.org/remarkable.css" rel="stylesheet"/>
  <link type="image/png" href="icon.png" rel="icon" >
 </head>
 <body>
 <header class="header-container" style="">
    <h1>Cadastre</h1>
 </header>
 <article>
<div class="toc"><span class="toctitle">Table of content</span><ul>
<li><a href="#documentation">Documentation</a><ul>
<li><a href="#installation">Installation</a></li>
<li><a href="#configurer-le-plugin">Configurer le plugin</a><ul>
<li><a href="#interface">Interface</a></li>
<li><a href="#nom-des-fichiers-majic">Nom des fichiers MAJIC</a></li>
<li><a href="#modele-de-composition-pour-lexport-de-la-vue-cartographique">Modèle de composition pour l'export de la vue cartographique</a></li>
<li><a href="#repertoire-temporaire">Répertoire temporaire</a></li>
<li><a href="#performances">Performances</a></li>
</ul>
</li>
<li><a href="#importer-des-donnees">Importer des données</a><ul>
<li><a href="#principe">Principe</a></li>
<li><a href="#bases-de-donnees">Bases de données</a><ul>
<li><a href="#remarque-sur-les-contraintes">Remarque sur les contraintes</a></li>
</ul>
</li>
<li><a href="#les-etapes-dimportation">Les étapes d'importation</a></li>
<li><a href="#projections-ignf">Projections IGNF</a></li>
</ul>
</li>
<li><a href="#charger-des-donnees">Charger des données</a><ul>
<li><a href="#base-de-donnees-de-travail">Base de données de travail</a></li>
<li><a href="#theme">Thème</a></li>
<li><a href="#couches-et-filtres">Couches et filtres</a></li>
<li><a href="#notes">Notes</a></li>
<li><a href="#charger-une-couche-a-partir-dune-requete">Charger une couche à partir d'une requête.</a></li>
</ul>
</li>
<li><a href="#la-barre-doutil-cadastre">La barre d'outil Cadastre</a><ul>
<li><a href="#identifier-une-parcelle">Identifier une parcelle</a></li>
<li><a href="#exporter-la-vue">Exporter la vue</a></li>
</ul>
</li>
<li><a href="#le-panneau-de-recherche">Le panneau de recherche</a><ul>
<li><a href="#principe_1">Principe</a></li>
<li><a href="#recherche-de-lieux">Recherche de lieux</a></li>
<li><a href="#recherche-dadresse">Recherche d'adresse</a></li>
<li><a href="#recherche-de-proprietaires">Recherche de propriétaires</a></li>
<li><a href="#utilisation-du-plugin-quickfinder-pour-chercher-les-parcelles">Utilisation du plugin QuickFinder pour chercher les parcelles</a></li>
</ul>
</li>
<li><a href="#a-propos">À propos</a></li>
<li><a href="#notes-de-version">Notes de version</a></li>
<li><a href="#videos-de-demonstration">Vidéos de démonstration</a></li>
<li><a href="#modele-de-donnees">Modèle de données</a><ul>
<li><a href="#les-parcelles">Les parcelles</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<h1 id="documentation">Documentation</h1>
<p><strong>Auteurs</strong> Michaël DOUCHIN - 3liz
<strong>Résumé</strong> Ce document contient la documentation du plugin Cadastre pour le logiciel QGIS.</p>
<p>La documentation de la base de données est disponible dans le dossier <a href="./database/">database</a>.</p>
<p><img alt="Financeurs" src="MEDIA/cadastre_financeurs.png"></p>
<h2 id="installation">Installation</h2>
<p>Le plugin Cadastre est dans les dépôts officiels du projet QGIS. Pour l'installer, il faut :</p>
<ul>
<li><strong>Lancer QGIS</strong></li>
<li>Menu <strong>Extension &gt; Installer/Gérer les extensions</strong></li>
<li>Onglet <strong>Paramètres</strong> &gt; Vérifier que la case <em>Afficher les extensions expérimentales</em> est bien cochée</li>
<li>Onglet <strong>En obtenir plus</strong> : chercher le plugin <strong>cadastre</strong>, le sélectionner et cliquer sur installer</li>
</ul>
<p>Une fois le plugin installé, un nouveau menu <strong>Cadastre</strong> apparaît dans le menu <em>Extensions</em> de QGIS. Il 
comporte les sous-menus suivants :</p>
<ul>
<li><strong>Importer des données</strong></li>
<li><strong>Charger des données</strong></li>
<li><strong>Outils de recherche</strong></li>
<li><strong>Exporter la vue</strong></li>
<li><strong>Configurer le plugin</strong></li>
<li><strong>À propos</strong></li>
<li><strong>Notes de version</strong></li>
<li><strong>Aide</strong></li>
</ul>
<p>Ces sous-menus sont détaillés dans les chapitres suivants.</p>
<h2 id="configurer-le-plugin">Configurer le plugin</h2>
<p>Avant d'importer les premières données cadastrales dans la base de données, il faut au préalable configurer le
plugin :</p>
<ul>
<li>Menu <strong>Cadastre &gt; Configurer le plugin</strong> ou l'icône <strong>outils</strong> de la barre d'outil Cadastre</li>
</ul>
<p><img alt="" src="MEDIA/cadastre_option_dialog.png"></p>
<h3 id="interface">Interface</h3>
<p>Les 2 boutons <strong>Interface Cadastre</strong> et <strong>Interface QGIS</strong> permettent d'ouvrir une aide pour appliquer une 
interface simplifiée adaptée à une utilisation de consultation du Cadastre.</p>
<p>À ce jour, QGIS ne permet pas de modifier dynamiquement l'interface via un plugin. Nous incorporerons cette 
fonctionnalité lorsque ce sera possible. En attendant, il faut donc le faire manuellement, comme expliqué dans 
la fenêtre d'aide.</p>
<h3 id="nom-des-fichiers-majic">Nom des fichiers MAJIC</h3>
<p>Cette partie permet de spécifier comment sont appelés les fichiers MAJIC sur votre poste de travail. En effet,
les conventions de nommage peuvent changer d'un département à l'autre. Souvent, les fichiers se terminent par 
une extension relative au département et à la direction, par exemple .800 pour les fichiers du département de 
la Somme.</p>
<p><strong>Il est important de bien configurer ces noms de fichiers avant votre premier import.</strong></p>
<p>Si le plugin ne trouve pas les fichiers MAJIC pendant l'import, alors que vous aviez spécifié le bon 
répertoire d'import, un message vous avertira et vous proposera d'annuler l'import.</p>
<h3 id="modele-de-composition-pour-lexport-de-la-vue-cartographique">Modèle de composition pour l'export de la vue cartographique</h3>
<p>Vous pouvez choisir ici le modèle de composeur d'impression qui sera utilisé dans la fonction <strong>Export la 
vue</strong>. Un modèle est fourni dans le répertoire <em>composeur</em> du plugin, et sera utilisé si vous ne proposez pas
le vôtre.</p>
<p>Pour l'instant, le modèle gère un bloc de carte, mais pas les blocs de table attributaire.</p>
<h3 id="repertoire-temporaire">Répertoire temporaire</h3>
<p>Vous pouvez choisir le répertoire dans lequel les scripts seront copiés, et les fichiers décompressés. 
Choisissez un répertoire contenant assez de place pour stocker les fichiers temporaires, surtout si vous 
souhaitez charger des données volumineuses.</p>
<p>Ce répertoire est aussi celui dans lequel les <strong>relevés parcellaires</strong> et les <strong>relevés de propriété</strong> seront
exportés.</p>
<h3 id="performances">Performances</h3>
<p>Vous pouvez modifier dans ce groupe les options suivantes pour adapter le plugin aux performances de votre 
matériel :</p>
<ul>
<li>
<p><strong>Taille maximum des requêtes INSERT</strong> : C'est le nombre total de requêtes <code>INSERT</code> lancées dans un groupe de 
  modification (BEGIN/COMMIT). Vous pouvez baisser le chiffre jusqu'à 10000 si vous avez une machine légère 
  et un gros volume de données à importer. Plus le chiffre est bas, plus l'import initial peut prendre du 
  temps.</p>
</li>
<li>
<p><strong>Stockage temporaire</strong> : Le mode <em>MEMORY</em> est plus rapide, mais nécessite assez de mémoire vive pour 
  stocker les données à traiter. Le mode <em>DEFAULT</em> est plus lent et adapté à des ordinateurs avec peu de 
  mémoire vive.</p>
</li>
</ul>
<h2 id="importer-des-donnees">Importer des données</h2>
<p>Cette boite de dialogue permet de réaliser un <strong>import de données EDIGEO et MAJIC</strong>.</p>
<p><img alt="" src="MEDIA/cadastre_import_dialog.png"></p>
<h3 id="principe">Principe</h3>
<p>Le plugin permet l'import de données <strong>MAJIC de 2012 à 2020 et des données EDIGEO</strong>. Il est possible 
d'importer des données de manière incrémentale, <strong>étape par étape</strong>, ou bien d'importer <strong>en une seule fois</strong>.</p>
<p>Le plugin utilise pour cela la notion de <strong>lot</strong>. Un lot regroupe un <strong>ensemble de données cohérent</strong> pour 
votre utilisation. Par exemple, le lot peut être le code d'une commune, ou l'acronyme d'une communauté de 
commune. C'est une chaîne de 10 caractères maximum. Vous pouvez utiliser des chiffres ou des lettres.</p>
<p>Vous pouvez par exemple importer les données dans cet ordre :</p>
<ul>
<li>données EDIGEO de la commune A, lot "com_a"</li>
<li>données EDIGEO de la commune B, lot "com_b"</li>
<li>données MAJIC de la commune A, lot "com_a"</li>
<li>données EDIGEO de la commune A, lot "com_a" (ré-import et écrasement des données précédentes)</li>
<li>données EDIGEO de la commune C, lot "com_c"</li>
</ul>
<p>Il est donc important de conserver une liste des lots définis pendant les imports successifs, pour savoir 
ensuite quel lot utiliser si on souhaite écraser des données. Une version prochaine du plugin pourra intégrer
un tableau récapitulatif des imports effectués dans une base de données pour faciliter le suivi des imports 
réalisés.</p>
<blockquote>
<p>Il est conseillé d'importer des données de millésime différents dans des bases de données ou des schémas 
PostGreSQL différents, car la structure peut changer d'un millésime à l'autre (ajout de colonnes, 
modification de longueur de champs, etc).</p>
</blockquote>
<h3 id="bases-de-donnees">Bases de données</h3>
<p>Deux <strong>Systèmes de Gestion de Bases de Données</strong> (SGBD) sont supportés par le plugin Cadastre :</p>
<ul>
<li><strong>PostGreSQL</strong> et son extension spatiale <strong>PostGIS</strong></li>
<li><strong>SQLite</strong> et son extension spatiale <strong>Spatialite</strong></li>
</ul>
<p>Nous conseillons d'utiliser PostGreSQL pour des données volumineuses et pour gérer des accès multiples à la 
base de données.</p>
<p>Pour les bases de données <strong>PostGIS</strong>, il faut :</p>
<ul>
<li>avoir créé <strong>une base de données</strong> sur laquelle on a les droits en écriture, et activer l'extension PostGIS.</li>
<li>avoir créé au préalable <strong>une connexion QGIS</strong> via le menu <strong>Couches &gt; Ajouter une couche PostGIS</strong> vers 
  cette base de données</li>
</ul>
<p>Pour les bases de données <strong>Spatialite</strong>, l'interface d'import permet de créer une base de données vide et la 
connexion QGIS liée si nécessaire.</p>
<h4 id="remarque-sur-les-contraintes">Remarque sur les contraintes</h4>
<p>Il n'existe actuellement aucune contrainte de clés étrangères sur les tables du schéma cadastre. Nous 
proposerons à l'avenir un script qui permettra de les créer, lorsque les données le permettent (ce qui n'est 
pas toujours le cas, comme des voies non référencées dans <code>voie</code> mais référencées dans <code>parcelle</code>).</p>
<h3 id="les-etapes-dimportation">Les étapes d'importation</h3>
<p>Pour lancer l'importation, il faut bien avoir au préalable configuré les noms des fichiers MAJIC via le menu 
<strong>Configurer le plugin</strong>. Ensuite, on ouvre la boite de dialogue</p>
<ul>
<li>via la <strong>barre d'outil Cadastre</strong>, icône base de données</li>
<li>via le menu <strong>Cadastre &gt; Importer des données</strong></li>
</ul>
<p>On configure ensuite les options :</p>
<ul>
<li>Choisir <strong>le type de base de données</strong> : PostGIS ou Spatialite</li>
<li>
<p>Choisir <strong>la connexion</strong></p>
<ul>
<li>Pour Postgis, on peut ensuite <strong>choisir un schema</strong>, ou en <strong>créer un nouveau</strong></li>
<li>Pour Spatialite, on peut <strong>créer une nouvelle base de données</strong></li>
</ul>
</li>
<li>
<p>Choisir le répertoire contenant les <strong>fichiers EDIGEO</strong> :</p>
</li>
<li>
<p>On peut sélectionner le <strong>répertoire parent</strong> qui contient l'ensemble des sous-répertoires vers les 
   communes : le plugin ira chercher les fichiers de manière récursive.</p>
</li>
<li>
<p>Seuls les fichiers <strong>zip</strong> et <strong>tar.bz2</strong> sont pour l'instant gérés</p>
</li>
<li>
<p>Choisir la <strong>projection source</strong> des fichiers EDIGEO et la <strong>projection cible</strong> désirée</p>
</li>
<li>
<p>Choisir le <strong>numéro du Département</strong>, par exemple : 80 pour la Somme</p>
</li>
<li>
<p>Choisir le <strong>numéro de la Direction</strong>, par exemple : 0</p>
</li>
<li>
<p>Choisir le répertoire contenant <strong>les fichiers MAJIC</strong></p>
<ul>
<li>Comme pour EDIGEO, le plugin ira chercher les fichiers dans les répertoires et les sous-répertoires et 
  importera l'ensemble des données.</li>
<li>Si vous ne possédez pas les données FANTOIR dans votre jeu de données MAJIC, nous conseillons vivement 
  de les télécharger et de configurer le plugin pour donner le bon nom au fichier FANTOIR : 
  <a href="https://www.collectivites-locales.gouv.fr/mise-a-disposition-gratuite-fichier-des-voies-et-des-lieux-dits-fantoir">https://www.collectivites-locales.gouv.fr/mise-a-disposition-gratuite-fichier-des-voies-et-des-lieux-dits-fantoir</a></li>
</ul>
</li>
<li>
<p>Choisir la <strong>version du format</strong> en utilisant les flèches haut et bas</p>
<ul>
<li>Seuls les formats de 2012 à 2020 sont pris en compte</li>
</ul>
</li>
<li>
<p>Choisir le <strong>millésime des données</strong>, par exemple 2020</p>
</li>
<li>
<p>Choisir le <strong>Lot</strong> : utilisez par exemple le code INSEE de la commune.</p>
</li>
<li>
<p>Activer ou désactiver la case à cocher <strong>Corriger les géométries invalides</strong> selon la qualité de votre jeu 
  de données EDIGEO.</p>
</li>
<li>
<p>Utiliser la barre de défilement de la fenêtre pour aller tout en bas et afficher tout le bloc texte de log 
  situé sous la barre de progression.</p>
</li>
<li>
<p>Lancer l'import en cliquant sur le bouton <strong>Lancer l'import</strong></p>
</li>
</ul>
<p>Le déroulement de l'import est écrit dans le bloc texte situé en bas de la fenêtre.</p>
<blockquote>
<p>Pendant l'import, il est conseillé de ne pas déplacer ou cliquer dans la fenêtre. Pour l'instant, le plugin
n'intègre pas de bouton pour annuler un import en cours.</p>
</blockquote>
<h3 id="projections-ignf">Projections IGNF</h3>
<p>Si votre donnée EDIGEO est en projection IGNF, par exemple pour la Guadeloupe, IGNF:GUAD48UTM20 (Guadeloupe 
Ste Anne), et que vous souhaitez importer les données dans PostgreSQL, il faut au préalable ajouter dans votre
table public.spatial_ref_sys la définition de la projection IGNF. Si vous utilisez à la place l'équivalent 
EPSG (par exemple ici EPSG:2970), vous risquez un décalage des données lors de la reprojection.</p>
<p>Vous pouvez ajouter dans votre base de données la définition via une requête, par exemple avec la requête 
suivante pour IGNF:GUAD48UTM20:</p>
<pre><code>INSERT INTO spatial_ref_sys values (
    998999,
    'IGNF',
    998999,
    'PROJCS[&quot;Guadeloupe Ste Anne&quot;,GEOGCS[&quot;Guadeloupe Ste Anne&quot;,DATUM[&quot;Guadeloupe St Anne&quot;,SPHEROID[&quot;International-Hayford 1909&quot;,6378388.0000,297.0000000000000,AUTHORITY[&quot;IGNF&quot;,&quot;ELG001&quot;]],TOWGS84[-472.2900,-5.6300,-304.1200,0.4362,-0.8374,0.2563,1.898400],AUTHORITY[&quot;IGNF&quot;,&quot;REG425&quot;]],PRIMEM[&quot;Greenwich&quot;,0.000000000,AUTHORITY[&quot;IGNF&quot;,&quot;LGO01&quot;]],UNIT[&quot;degree&quot;,0.01745329251994330],AXIS[&quot;Longitude&quot;,EAST],AXIS[&quot;Latitude&quot;,NORTH],AUTHORITY[&quot;IGNF&quot;,&quot;GUAD48GEO&quot;]],PROJECTION[&quot;Transverse_Mercator&quot;,AUTHORITY[&quot;IGNF&quot;,&quot;PRC0220&quot;]],PARAMETER[&quot;semi_major&quot;,6378388.0000],PARAMETER[&quot;semi_minor&quot;,6356911.9461],PARAMETER[&quot;latitude_of_origin&quot;,0.000000000],PARAMETER[&quot;central_meridian&quot;,-63.000000000],PARAMETER[&quot;scale_factor&quot;,0.99960000],PARAMETER[&quot;false_easting&quot;,500000.000],PARAMETER[&quot;false_northing&quot;,0.000],UNIT[&quot;metre&quot;,1],AXIS[&quot;Easting&quot;,EAST],AXIS[&quot;Northing&quot;,NORTH],AUTHORITY[&quot;IGNF&quot;,&quot;GUAD48UTM20&quot;]]',
    '+init=IGNF:GUAD48UTM20'
);
</code></pre>

<p>Attention, il est important d'utiliser un code qui est &lt;= 998999, car PostGIS place des contraintes sur le 
SRID. Nous avons utilisé ici 998999, qui est le maximum possible.
La liste des caractéristiques des projections peut être trouvée à ce lien : 
<a href="http://librairies.ign.fr/geoportail/resources/IGNF-spatial_ref_sys.sql">http://librairies.ign.fr/geoportail/resources/IGNF-spatial_ref_sys.sql</a> (voir discussion Géorézo : <a href="https://georezo.net/forum/viewtopic.php?pid=268134">https://georezo.net/forum/viewtopic.php?pid=268134</a>).
Attention, il faut extraire de ce fichier la commande INSERT qui correspond à votre code IGNF, et remplacer le
SRID par 998999.</p>
<p>Ensuite, dans la projection source, vous pouvez utiliser IGNF:GUAD48UTM20 au lieu du code EPSG correspondant.</p>
<h2 id="charger-des-donnees">Charger des données</h2>
<p>Une fois les données importées dans la base, vous pouvez les importer dans QGIS via le menu 
<strong>Charger les données</strong>.</p>
<p><img alt="" src="MEDIA/cadastre_load_dialog.png"></p>
<h3 id="base-de-donnees-de-travail">Base de données de travail</h3>
<p>Il faut d'abord indiquer au plugin où récupérer les données :</p>
<ul>
<li>Choisir le <strong>type de base</strong> de données</li>
<li>Choisir ensuite <strong>la connexion</strong> vers la base de donnée dans lequel l'import a été fait</li>
<li>Si PostGIS, choisir <strong>le schéma</strong> contenant les données</li>
</ul>
<h3 id="theme">Thème</h3>
<p>Puis on peut choisir un <strong>thème</strong> à utiliser pour la symbologie des couches :</p>
<ul>
<li><strong>Classique</strong> : un thème proche du rendu de <a href="http://cadastre.gouv.fr">cadastre.gouv.fr</a></li>
<li><strong>Orthophoto</strong> : un thème adapté à un affichage par dessus un fond orthophoto.</li>
</ul>
<h3 id="couches-et-filtres">Couches et filtres</h3>
<ul>
<li>
<p>En cochant la case <strong>Ajouter seulement Commune, sections, parcelles et bâti</strong>, vous indiquez que vous 
  souhaitez ouvrir seulement ces couches dans QGIS (et pas les autres couches comme les bornes, les croix, 
  etc.)</p>
</li>
<li>
<p><strong>Filtrer par expression sur les communes</strong> : cette option vous permet de ne pas charger la totalité des 
  données, mais seulement celles qui correspondent aux communes filtrées via une expression. Vous devez 
  connaître la structure de la table <strong>geo_commune</strong> pour pouvoir réaliser ce filtre. Si l'expression est 
  invalide, alors le plugin chargera l'ensemble des données.</p>
</li>
</ul>
<p>Attention à cette deuxième option, qui est expérimentale, et qui peut poser des soucis de performance. Pour 
information, cette option ajoute un filtre à chaque couche via une sous-requête. Une fois les couches 
chargées, vous pouvez consulter ce filtre via l'onglet <em>Général</em> de la boîte de dialogue des propriétés de 
chaque couche.</p>
<p>Exemples d'expression :</p>
<ul>
<li><code>substr("geo_commune", 5, 6) LIKE '54033%'</code> -&gt; les communes du département 54, direction 0, dont le code
  INSEE commence par 33</li>
<li><code>"tex2" IN ('AMIENS', 'ALLONVILLE')</code> -&gt; le nom de la commune est AMIENS ou ALLONVILLE</li>
</ul>
<h3 id="notes">Notes</h3>
<p>Pensez à <strong>enlever les données cadastrales existantes dans votre projet QGIS</strong> : Le plugin ne sait pas gérer 
la recherche et l'interrogation de données si on a plus qu'une version des couches parcelles, communes et 
sections dans le projet QGIS.</p>
<p>Enfin, cliquez sur le bouton <strong>Charger les données</strong> pour lancer le chargement.</p>
<h3 id="charger-une-couche-a-partir-dune-requete">Charger une couche à partir d'une requête.</h3>
<p>L'onglet <strong>Charger une requête</strong> vous donne la possibilité d'utiliser une requête SQL pour récupérer des 
données de la base. Pour cela, il faut bien connaître le modèle de la base de données, et les spécificités
des données MAJIC. Cette fonctionnalité vise à évoluer pour proposer une liste de requêtes intéressantes pour 
l'exploitation des données cadastrales.</p>
<p><img alt="" src="MEDIA/cadastre_load_dialog_requete.png"></p>
<p>Une fois la connexion choisie, vous pouvez écrire le texte SQL dans le champ texte.</p>
<ul>
<li>La requête peut renvoyer des données spatiales ou seulement des données attributaires.</li>
<li>Si un des champs retournés est une géométrie, vous devez spécifier son nom dans le champ texte dédié.</li>
<li>Si vous utilisez une connexion PostGIS, il faut préfixer les tables avec le nom du schéma. Par exemple 
  <code>cadastre.geo_parcelle</code>.</li>
</ul>
<p>La requête suivante retourne par exemple pour chaque code de parcelle la date de l'acte (on suppose que le 
schéma est cadastre). Vous pouvez ensuite utiliser une jointure QGIS pour faire le lien avec la couche 
<code>Parcelles</code> :</p>
<pre><code>SELECT p.parcelle, p.jdatat AS date_acte
FROM cadastre.parcelle p
</code></pre>

<p>La requête suivante renvoie toutes les parcelles appartenant à des collectivités locales, avec la géométrie 
et les noms des propriétaires</p>
<pre><code>SELECT gp.geo_parcelle,
string_agg(
   trim(
      concat(
         pr.dnuper || ' - ',
         trim(pr.dqualp) || ' ',
         trim(pr.ddenom)
      )
   ),'|'
) AS proprietaire,
gp.geom AS geom
FROM cadastre.geo_parcelle gp
JOIN cadastre.parcelle p ON gp.geo_parcelle = p.parcelle
JOIN cadastre.proprietaire pr ON p.comptecommunal = pr.comptecommunal
WHERE pr.dnatpr = 'CLL'
GROUP BY gp.geo_parcelle, gp.geom
</code></pre>

<h2 id="la-barre-doutil-cadastre">La barre d'outil Cadastre</h2>
<p><img alt="" src="MEDIA/cadastre_toolbar.png"></p>
<p>La barre d'outil peut s'afficher ou se masquer à partir :</p>
<ul>
<li>du menu <strong>Vue &gt; Barres d'outils &gt; Cadastre</strong></li>
<li>d'un clic droit à côté d'une des barres d'outils de QGIS, et sélectionner <strong>Cadastre</strong></li>
</ul>
<p>Elle contient :</p>
<ul>
<li>Un outil pour <strong>identifier une parcelle</strong> sur la carte</li>
<li>Des boutons qui reprennent les sous-menus du plugin : Importer, Charger, Rechercher, Exporter la vue, 
  Configurer, À propos</li>
</ul>
<p>Pour connaître l'action d'une des icônes, il suffit de laisser la souris un moment au-dessus pour voir 
apparaître une bulle d'information.</p>
<h3 id="identifier-une-parcelle">Identifier une parcelle</h3>
<p>Pour avoir des informations complètes sur une parcelle, il faut avoir au préalable importé des données MAJIC 
dans la base de données. Sinon, seules les informations principales issues de l'EDIGEO seront affichées et 
certains boutons d'action sont désactivés.</p>
<p>Pour faire apparaître la fiche d'information d'une parcelle, il faut :</p>
<ul>
<li>activer l'outil <strong>Identifier une parcelle</strong> de la barre d'outil</li>
<li><strong>Zoomer à une échelle</strong> pour laquelle les parcelles sont visibles (à partir de 1/20 000).</li>
<li><strong>Cliquer sur une des parcelles</strong> de la carte.</li>
</ul>
<p>La fenêtre d'identification s'affiche alors,</p>
<p><img alt="" src="MEDIA/cadastre_parcelle_info.png"></p>
<p>Elle présente plusieurs onglets :</p>
<ul>
<li>un onglet avec les <strong>informations générales de la parcelle</strong></li>
<li>un onglet avec les <strong>propriétaires</strong> de la parcelle</li>
<li>un onglet avec les <strong>subdivisions fiscales</strong></li>
<li>un onglet avec les <strong>locaux</strong> et leurs informations détaillées</li>
</ul>
<p>Ainsi qu'une zone contenant des <strong>boutons d'action</strong> :</p>
<ul>
<li>2 boutons pour <strong>exporter</strong> le <strong>relevé parcellaire</strong> et le <strong>relevé de propriété</strong> au format PDF</li>
<li>3 boutons pour <strong>interagir avec l'objet géométrique</strong> lié à la parcelle : centrer la carte sur la 
    parcelle, zoomer sur la parcelle, ou sélectionner l'objet dans la couche</li>
<li>Un dernier bouton pour <strong>sélectionner dans la couche toutes les parcelles du propriétaire</strong></li>
</ul>
<blockquote>
<p>Si vous n'avez pas importé de données FANTOIR, la commune de la parcelle ne sera pas affichée dans la 
fenêtre et l'adresse pourra être tronquée (de même pour les relevés exportés)</p>
<p>Si vous n'avez pas de données MAJIC, seule les informations sur la parcelle (1er onglet) seront présentées.</p>
</blockquote>
<h3 id="exporter-la-vue">Exporter la vue</h3>
<p>Dans la barre d'outil Cadastre, ainsi que dans le menu, vous pouvez exporter la vue courante de la carte en 
PDF via le menu <strong>Exporter la vue</strong>.</p>
<p>Cette fonctionnalité s'appuie sur un <strong>modèle de composeur d'impression</strong>, configurable dans les options du 
plugin (voir ci-dessus). Si vous n'avez pas configuré de composeur personnalisé, celui installé par le plugin 
est utilisé.</p>
<blockquote>
<p>Cette fonctionnalité est basique, et ne gère pas pour l'instant les composeurs complexes, avec des tables 
attributaires et des configurations d'atlas.</p>
</blockquote>
<h2 id="le-panneau-de-recherche">Le panneau de recherche</h2>
<p><img alt="" src="MEDIA/cadastre_search_dialog.png"></p>
<h3 id="principe_1">Principe</h3>
<p>Le panneau de recherche propose des outils pour rechercher des parcelles via 3 entrées principales</p>
<ul>
<li>une recherche par <strong>objet géographique</strong> : commune, section, adresse et parcelles</li>
<li>une recherche par <strong>propriétaire</strong></li>
</ul>
<p>Les différentes recherches seront détaillées dans les sous-chapitres suivants.</p>
<p>Pour afficher le panneau de recherche:</p>
<ul>
<li>Utiliser le menu <strong>Cadastre &gt; Outils de recherche</strong> ou cliquer sur l'<strong>icône loupe</strong> de la barre d'outils</li>
</ul>
<p>Une bulle d'information affiche la fonction des boutons au survol de la souris.</p>
<blockquote>
<p>Si la base de données ne contient aucune donnée MAJIC, alors les recherches par adresse et par propriétaire
sont désactivés.</p>
</blockquote>
<h3 id="recherche-de-lieux">Recherche de lieux</h3>
<p>L'outil présente 3 listes déroulantes :</p>
<ul>
<li><strong>Commune</strong></li>
<li><strong>Section</strong></li>
<li><strong>Adresses</strong></li>
<li><strong>Parcelles</strong></li>
</ul>
<p>Il est possible de <strong>sélectionner une entité</strong> dans les listes :</p>
<ul>
<li>soit <em>à la souris</em> en cliquant sur la flèche pour ouvrir la liste déroulante puis sélectionner un item.</li>
<li>soit en <em>tapant les premières lettres</em> et en sélectionnant l'item choisi dans la liste d'autocomplétion qui 
  s'affiche alors. Il faut avoir au préalable vider le contenu de la liste déroulante.</li>
</ul>
<p>Les listes déroulantes sont <strong>hiérarchiques</strong> :</p>
<ul>
<li>Lorsqu'on choisit une commune, la liste des sections est rafraîchie et ne montre que les sections de la 
  commune choisie. La recherche d'adresse est aussi filtrée sur cette commune.</li>
<li>lorsqu'on choisit une section, la liste des parcelles est rafraîchie et montre les parcelles sur la section.</li>
</ul>
<p>Des <strong>boutons d'actions</strong> sont positionnés sous les 3 listes déroulantes et permettent de lancer l'action 
choisie sur le dernier objet sélectionné dans les 3 listes :</p>
<ul>
<li><em>Centrer sur l'objet</em> : la carte est déplacée vers l'objet sélectionné, mais l'échelle est conservée</li>
<li><em>Zoomer sur l'objet</em> : la carte est déplacée et mise à l'échelle pour afficher l'objet sélectionné</li>
<li><em>Sélectionner l'objet</em> : l'objet est sélectionné dans la couche de données correspondante (Communes, 
  Sections ou Parcelles)</li>
</ul>
<p>À côté des listes, un bouton <strong>croix rouge</strong> permet de remettre la liste à son état initial, c'est-à-dire sans
objet sélectionné. Par exemple, si on avait sélectionné une commune dans la première liste et une section 
dans la seconde, on peut cliquer sur la croix rouge à côté de la section pour désélectionner la section dans 
la liste. Ainsi si on utilise le bouton de Zoom, on zoomera sur la commune et non sur la section qui était 
précédemment sélectionnée</p>
<p>Si une parcelle a été sélectionnée dans la liste <strong>Parcelles</strong>, il est possible d'<strong>exporter le relevé 
parcellaire</strong> en cliquant sur le bouton <em>icône PDF</em> situé en bas à droite du bloc de recherche de lieux. 
Le <strong>PDF est généré et ouvert</strong> avec le lecteur PDF par défaut du système.</p>
<h3 id="recherche-dadresse">Recherche d'adresse</h3>
<blockquote>
<p>Pour l'instant, cet outil ne fonctionne que si des données MAJIC sont dans la base, et si les données 
FANTOIR ont été importées. Si vous ne possédez pas de données FANTOIR dans votre lot de données MAJIC,
vous pouvez le télécharger pour votre département ici (et relancer l'import Majic) : 
<a href="http://www.collectivites-locales.gouv.fr/mise-a-disposition-fichier-fantoir-des-voies-et-lieux-dits">http://www.collectivites-locales.gouv.fr/mise-a-disposition-fichier-fantoir-des-voies-et-lieux-dits</a></p>
</blockquote>
<p>Pour lancer une <strong>recherche de parcelles par adresse</strong>, il suffit :</p>
<ul>
<li>d'<em>entrer l'adresse cherchée</em>, sans le numéro de rue dans la liste <strong>Adresse</strong>.</li>
<li>de cliquer sur le <strong>bouton loupe</strong> situé à côté de la liste, ou d'appuyer sur la <strong>touche entrée</strong></li>
</ul>
<p>La recherche est effectuée et la liste déroulante où vous avez tapé l'adresse à chercher est maintenant 
rafraîchie et contient l'ensemble des résultats trouvés. Si une commune était sélectionnée dans la liste des 
communes, la recherche d'adresse ne renvoie que les voies de cette commune.</p>
<p>Si des résultats ont été trouvés, on peut ensuite :</p>
<ul>
<li><strong>Sélectionner une adresse</strong> dans la liste déroulante via la souris. Cela <strong>rafraîchit la liste des 
  parcelles</strong> située en dessous.</li>
<li>cliquer sur les boutons de <strong>centrage, zoom et sélection</strong>. Chaque action est lancée sur <strong>l'ensemble des 
  parcelles correspondantes</strong> à l'adresse choisie</li>
<li>Sélectionner une des parcelles dans la liste déroulante <strong>Parcelles</strong> et réutiliser les boutons d'action.</li>
<li>Si une parcelle est sélectionnée, le bouton avec une icône PDF permet d'<strong>exporter le relevé parcellaire</strong> 
  pour cette parcelle</li>
</ul>
<p>Vous pouvez cliquer sur la croix rouge à côté de la recherche d'adresse pour désélectionner l'adresse choisie.</p>
<h3 id="recherche-de-proprietaires">Recherche de propriétaires</h3>
<blockquote>
<p>Ce bloc de recherche ne fonctionne pas si aucune donnée MAJIC n'est présente dans la base</p>
</blockquote>
<p>Le principe et le fonctionnement est le même que pour la recherche par adresse, avec les différences 
suivantes :</p>
<ul>
<li>Un bouton est ajouté à côté de la liste des propriétaires pour <strong>exporter le relevé de propriété</strong> du 
  propriétaire sélectionné dans la liste</li>
<li>Le bouton d'<strong>export du relevé parcellaire</strong> est placé à côté de la liste <em>Parcelles</em></li>
</ul>
<p>Il est possible d'exporter le relevé de propriété pour les personnes qui ne possèdent pas de propriété non
bâtie.</p>
<h3 id="utilisation-du-plugin-quickfinder-pour-chercher-les-parcelles">Utilisation du plugin QuickFinder pour chercher les parcelles</h3>
<p>Vous pouvez installer le plugin QuickFinder pour préparer et utiliser des recherches sur différentes couches
cadastrales. Exemple de configuration intéressante :</p>
<ul>
<li>Ouvrir la boîte de dialogue de configuration du plugin : Menu <em>Extension / QuickFinder / Settings</em></li>
<li>Aller à l'onglet <em>Project Search</em></li>
<li>Cocher la case <em>Search in project layers</em></li>
<li>À côté du champ <em>QuickFinder file</em>, cliquer sur le bouton avec une icône "page" pour créer un nouveau 
  fichier (en anglais, au survol du bouton : <em>Create a new QuickFinder file</em>). Enregistrer le fichier dans le
  répertoire du projet QGIS, et lui donner le même nom de fichier (par exemple "cadastre.qfts" pour un projet 
  QGIS "cadastre.qgs")</li>
<li>Cliquer sur le bouton "+" en vert pour ajouter une nouvelle recherche : cela ouvre une boite de dialogue 
  <em>project search</em>. Configurer une recherche pour les parcelles :</li>
<li><em>Search name</em> : Parcelles</li>
<li><em>Layer</em>: Parcelles</li>
<li><em>Field</em> : vous pouvez utiliser un champ, ou mieux une expression QGIS pour concaténer des informations, 
    en cliquant sur le bouton "epsilon", par exemple :
  <code>sql
  Concat(
    'COM ', "codecommune", ' / ',
    'SEC ', substr("idu", 7, 2), ' / ',
    'PAR ', substr("idu", 9, 4), ' / ',
    'ADR ', "adresse", ' / ',
    '', "proprietaire",
    ' @@', "codecommune"
  )</code>
  (la partie avec @@ et le codecommune à la fin sont utiles si vous publiez le cadastre sur internet vers 
  l'application Lizmap. Cela permet de filtrer les données)</li>
<li><em>Geometry storage</em> : wkt</li>
<li><em>Priority</em> : 1</li>
<li><em>record entries</em> : laisser coché, cela va lancer la création des données de recherche et leur stockage 
    dans le fichier QuickFinder</li>
</ul>
<p>Une fois cette configuration effectuée, vous pouvez fermer les fenêtres QuickFinder, puis utiliser la barre 
d'outil QuickFinder pour chercher des parcelles via leur code, le code commune, le code de section, ou bien 
le nom des propriétaires.</p>
<h2 id="a-propos">À propos</h2>
<p>Le menu <strong>Cadastre &gt; À propos</strong> ouvre une fenêtre d'information sur le plugin Cadastre : financeurs, auteur,
licence, dépôt de sources, etc.</p>
<p>Cette fenêtre est automatiquement affichée lors de la première utilisation du plugin, mais pas les fois 
suivantes.</p>
<h2 id="notes-de-version">Notes de version</h2>
<p>Le menu <strong>Cadastre &gt; Notes de version</strong> ouvre une fenêtre qui montre les changements effectués sur le plugin 
Cadastre entre la version installée et la version précédente. Cette fenêtre est affichée automatiquement une 
première fois lors de la montée de version.</p>
<h2 id="videos-de-demonstration">Vidéos de démonstration</h2>
<p>Pour faciliter la prise en main, vous pouvez consulter les vidéos en ligne :</p>
<ul>
<li>Import et chargement : <a href="https://vimeo.com/75004889">https://vimeo.com/75004889</a></li>
<li>Recherche : <a href="https://vimeo.com/74807532">https://vimeo.com/74807532</a></li>
</ul>
<h2 id="modele-de-donnees">Modèle de données</h2>
<p>Le lien suivant permet de voir comment sont organisées les données cadastrales dans la base de données 
(tables, contraintes, etc.) : <a href="https://docs.3liz.org/QgisCadastrePlugin/database/">https://docs.3liz.org/QgisCadastrePlugin/database/</a></p>
<h3 id="les-parcelles">Les parcelles</h3>
<p>Dans le modèle, plusieurs tables contiennent des informations sur les parcelles</p>
<ul>
<li>
<p><strong>geo_parcelle</strong> : contient les parcelles EDIGEO</p>
</li>
<li>
<p><strong>parcelle</strong> : contient les données MAJIC liées aux parcelles cadastrales</p>
</li>
<li>
<p><strong>parcelle_info</strong> : contient une version consolidée des parcelles EDIGEO et MAJIC : la géométrie EDIGEO, et
  les informations résumées de la parcelle, dont les propriétaires (information séparées par la barre 
  verticale | si la parcelle a plusieurs propriétaires)</p>
</li>
</ul>
<p>Les champs parcelle.parcelle et geo_parcelle.geo_parcelle peuvent être utilisés pour les jointures entre la 
table parcelle et la table geo_parcelle</p>
<p>L'identifiant <strong>geo_parcelle</strong> (ou parcelle) est unique et constitué comme suit :
<em>Année (4) + Département (2) + Direction (1) + Commune (3) + Préfixe (3) + Secteur (2) + Numéro de plan (4)</em>
soit <strong>19 caractères</strong></p>
<p><img alt="" src="MEDIA/logo_3liz.png"></p>
  </article>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.1/highlight.min.js">
  </script>
  <script>
   hljs.initHighlightingOnLoad();
  </script>
  <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript">
  </script>
  <script type="text/javascript">
   MathJax.Hub.Config({"showProcessingMessages" : false,"messageStyle" : "none","tex2jax": { inlineMath: [ [ "$", "$" ] ] }});
  </script>
 </body>
</html>
